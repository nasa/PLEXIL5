in ../../lib/test/test.maude
in ../../src/plexilite.maude
in ./base.maude
in ./atomic/test.maude
in ./reductions/test.maude
in ./expressions/test.maude
in ./model-checking.maude
in ./compiler/test.maude

mod TEST-SUITE is

  pr TEST--ATOMIC .
  pr TEST--REDUCTIONS .
  pr TEST--EXPRESSIONS .
  pr TEST--MODEL-CHECKING .
  pr TEST--COMPILER .

  eq tests =
    AllTestsPassed
    + atomic--tests
    + reductions--tests
    + expressions--tests
    + model-checking--tests
    + compiler--tests
    +
begin tests

    assert "An Update node" from
      testConfiguration(
        < 'anUpdate : update |
          pairs: (pair('val,const(val("foo"))) pair('taskId,var('waypointId))),
          ack: false >
      )
    reaches
      testConfiguration(
        < 'anUpdate : update |
          pairs: (pair('val,const(val("foo"))) pair('taskId,var('waypointId))),
          ack: false >
      )
    end

    assert "Compile Update node 1" from
      testConfiguration(
        compileNodes(update('anId, nilocdecl, none, pair('taskId,var('waypointId))), 'aRootId)
      )
    reaches
      testConfiguration(
        < 'anId . 'aRootId : update |
          defaultInternalAttributes,
          pairs:   pair('taskId,var('waypointId)),
          startc:  const(val(true)),
          skip:    const(val(false)),
          pre:     const(val(true)),
          inv:     const(val(true)),
          exitc:   const(val(false)),
          repeatc: const(val(false)),
          post:    const(val(true)),
          endc:    hasRcvAck?('anId . 'aRootId) >
      )
    end

    assert "Compile Update node 2" from
      testConfiguration(
        compileNodes(update('anId, nilocdecl, endc: const(val(false)), pair('taskId,var('waypointId))), 'aRootId)
      )
    reaches
      testConfiguration(
        < 'anId . 'aRootId : update |
          defaultInternalAttributes,
          pairs:   pair('taskId,var('waypointId)),
          startc:  const(val(true)),
          skip:    const(val(false)),
          pre:     const(val(true)),
          inv:     const(val(true)),
          exitc:   const(val(false)),
          repeatc: const(val(false)),
          post:    const(val(true)),
          endc:    const(val(false)) and hasRcvAck?('anId . 'aRootId) >
      )
    end

end tests
.

endm

set show stats   off .
set show command off .
set show timing  off .

load ../../lib/test/test-runner.maude

reduce in TEST-RUNNER : runTests .
